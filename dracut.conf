# dracut.conf - Dracut configuration for reproducible builds

# Explicitly set the modules to include, overriding dracut's defaults.
# This avoids errors from missing tools in the build environment.
dracutmodules+=" base shutdown fs-lib paypal-auth-vm "

# Omit modules we know we don't need (less critical now, but good practice)
# Note: we omit 'network' since it doesn't work in containers
# Omit 'firmware' to avoid /sys/module/firmware_class/parameters/path error in containers
omit_dracutmodules+=" dash plymouth network syslog firmware "

# Compression
compress="gzip"
#compresslevel="9"
reproducible="yes"

# Reproducibility settings
export SOURCE_DATE_EPOCH="1640995200"  # Fixed timestamp
export TZ="UTC"

# Host-only mode disabled for reproducibility
hostonly="no"
hostonly_cmdline="no"

    
sysloglvl=0
#stdloglvl=3

# Don't fail on missing optional items
install_optional_items+=" "


# Install kernel modules
kernel_cmdline=""
# Virtio drivers for OCI, SEV/CCP drivers for confidential computing
add_drivers+=" virtio_pci virtio_blk virtio_net virtio_scsi dm_crypt sev-guest ccp "

# Firmware - not needed since no_kernel="yes"
# firmware_dirs="/lib/firmware"

# No local system configuration
no_host_only_commandline="yes"

# Include kernel modules (required for OCI boot)
no_kernel="no"
